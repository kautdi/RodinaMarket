import { useSelector } from "react-redux";
import { Link } from "react-router-dom"
import { selectCart } from "../redux/cart/selectors";
import { useEffect, useState } from "react";
import { useAppDispatch } from "../redux/store";
import { fetchCartItem, fetchTotalPricing } from "../redux/cart/asyncAction";
import { selectAuth } from "../redux/auth/selectors";
import ModalAdd from "./ModalAuth";

function Header() {
  const { totalPrice, count } = useSelector(selectCart);
  const { isAuth, iduser, role } = useSelector(selectAuth);
  const [active, setActive] = useState<boolean>(false)
  const dispatch = useAppDispatch();

  useEffect(() => {
    dispatch(fetchTotalPricing());
    dispatch(fetchCartItem());
  }, []);

  return (
    <div className="header">
      <div className="container">
        <div className="header__logo">
          <a href="/" className="logo">
            <svg width="104" height="53" viewBox="0 0 104 53" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M101.719 18.4295C101.719 18.4295 99.0599 21.0995 97.8578 20.8838C96.9427 20.7177 99.6966 16.3159 99.6966 16.3159L97.519 14.2347C97.9892 14.1154 98.4663 14.0253 98.9477 13.9652L97.396 9.70573C97.396 9.70573 91.8516 10.1371 87.7489 15.6625C87.736 15.6344 82.9016 22.7795 81.4902 22.8356C81.1535 22.8485 81.6046 21.0218 82.2866 19.4992C82.788 18.3885 83.3544 17.3083 83.9829 16.2642L80.6075 14.61C80.6075 14.61 79.5284 16.6481 78.4493 19.2706L75.9674 18.9988C77.2192 15.6517 78.2961 13.5166 78.2961 13.5166L74.1804 11.5928C74.1804 11.5928 72.9028 14.7588 71.4352 18.96C71.2043 19.62 70.9561 20.3619 70.7036 21.1426C70.487 21.635 70.2101 22.0986 69.8792 22.5229C68.6879 23.8773 66.4261 26.1116 66.2103 25.4495C65.9945 24.7529 69.6094 18.6085 69.6094 18.6085L66.0463 16.7279C66.0463 16.7279 64.8895 18.6106 63.6118 21.0606C63.6118 21.0606 60.107 26.3208 58.7149 25.9412C58.2833 25.8226 59.3084 22.6415 61.0997 19.5876C63.8902 14.8429 68.7159 8.32545 68.7159 8.32545C68.7159 8.32545 59.7595 12.2506 51.6685 13.1564C51.1268 12.2075 49.0506 9.54182 43.9271 8.60151C37.2367 7.37436 34.498 9.47712 33.7621 10.4757C33.5182 10.8078 33.1945 14.9314 41.4625 16.6934C43.7156 17.1721 46.1112 17.2972 48.3686 17.2843C48.4268 18.305 48.4094 19.3286 48.3168 20.3468L48.3967 20.3921L48.306 20.4654C48.224 21.3928 48.0902 22.4236 47.8744 23.5688C47.3974 26.0814 44.9609 29.0511 44.4213 28.8613C43.8818 28.6715 43.6422 26.8513 44.6846 24.6278C45.522 22.842 47.8269 20.8644 48.3039 20.4654C48.3039 20.4266 48.3039 20.3856 48.3147 20.3468L44.4861 18.3411C44.4861 18.257 44.1105 18.8371 43.1091 19.8507C43.1091 19.8507 42.7358 20.2389 42.5437 20.4589C41.7452 21.2245 40.146 22.4495 38.031 22.5229C35.1778 22.6199 33.9736 21.7486 33.5959 21.3841C34.0778 21.0444 34.5909 20.7513 35.1282 20.5085L32.0355 16.1412L27.4883 17.1074C28.5872 15.2484 29.4122 13.2407 29.9378 11.1464C32.9398 -1.39469 20.8346 -2.25952 13.391 3.16668C-13.4136 22.717 8.30636 52.5158 8.30636 52.5158C8.30636 52.5158 16.1664 24.617 16.3779 23.832L19.298 26.5817C21.3898 24.8753 23.2868 22.9435 24.9545 20.8212L28.1422 20.3662C27.0631 21.8284 26.0444 23.5732 25.4941 25.4452C23.9575 30.6751 24.8056 36.4442 27.8789 37.0912C31.824 37.9323 34.7181 33.8389 36.08 30.2093C36.5438 28.9774 36.8617 27.6955 37.0274 26.3898C37.3425 26.4056 37.6835 26.4164 38.0504 26.4221C38.5804 26.4323 39.109 26.3647 39.6194 26.2216C39.5654 26.4782 39.5179 26.737 39.4813 27.0044C38.946 30.921 39.2546 34.1387 42.2869 34.9583C45.0925 35.7196 49.6592 30.6449 51.5563 25.1648C52.685 21.9082 52.7799 19.139 52.5512 17.0902C54.4781 16.9249 56.3951 16.6585 58.2941 16.2922C58.2941 16.2922 54.8173 21.0089 53.3475 25.8377C50.3887 35.5708 55.3007 33.675 57.2862 32.1114C58.3653 31.2488 59.507 29.9548 60.4717 28.706C60.0832 30.4767 60.2408 31.8052 61.4321 32.0683C63.2471 32.4694 66.3829 30.0324 68.5908 28.031C68.1764 29.4458 67.9045 30.4034 67.9045 30.4034L72.1129 31.7254C72.1129 31.7254 73.328 26.9936 74.6811 22.7083L77.1328 22.9607C76.9774 23.4847 76.835 24.0067 76.7185 24.5178C76.1552 26.9915 76.6257 29.463 77.7781 29.5472C79.6471 29.6852 82.1096 27.5458 84.216 25.2058C84.1685 27.2072 84.6476 28.4408 85.0469 28.4408C89.0589 28.4408 91.707 24.6019 92.6286 23.0232C92.1343 25.0289 92.1624 26.6486 93.3623 26.9872C97.355 28.1151 104 20.2734 104 20.2734L101.719 18.4295ZM39.5978 11.7438C39.7186 11.6252 40.938 11.2025 43.1739 11.7934C44.4655 12.1337 45.6986 12.6659 46.832 13.3721C42.2998 13.2621 40.2776 12.2053 39.5978 11.7373V11.7438ZM11.0062 23.5516C9.21927 28.7492 7.9481 31.1194 6.15465 37.2012C0.977183 15.766 15.8924 6.68638 17.5196 5.82371C16.1859 8.81717 13.5399 16.1758 11.0062 23.5516ZM24.6589 13.2513C23.6775 15.2411 22.3421 17.0359 20.718 18.5481L17.7333 19.1779C19.872 12.3326 22.2288 6.68638 22.2288 6.68638L19.7404 5.1422C24.0265 3.45136 29.3098 4.06817 24.661 13.2513H24.6589ZM33.3455 22.8615L33.2938 22.8377C33.2938 22.8377 33.283 25.5012 32.383 27.8175C31.619 29.7779 30.3802 31.5852 29.7328 31.2574C29.0853 30.9296 28.6537 28.6586 31.0579 24.1102C31.6401 23.0675 32.4519 22.1708 33.4319 21.4877L33.3455 22.8615ZM95.1277 16.5661L95.1428 16.523C95.1428 16.523 91.2581 22.0117 89.5488 21.6602C88.6273 21.4704 90.1315 18.3475 92.5379 16.523C93.6111 15.7256 94.8014 15.0993 96.0665 14.6661C95.8011 15.1837 95.4752 15.8328 95.1277 16.5661Z" fill="#222222"></path>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M19.9646 49.0331L100.387 31.7042L21.089 43.5314L19.9646 49.0331Z" fill="#222222"></path>
            </svg>
          </a>
        </div>
        <div className="header__cart">
          {
            role === "company" ? (
              <></>
            )
              : (
                <Link to="/cart" className="button button--cart">


                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 18 18"
                    fill="#000000"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M6.33333 16.3333C7.06971 16.3333 7.66667 15.7364 7.66667 15C7.66667 14.2636 7.06971 13.6667 6.33333 13.6667C5.59695 13.6667 5 14.2636 5 15C5 15.7364 5.59695 16.3333 6.33333 16.3333Z"
                      stroke="#000000"
                      stroke-width="1.8"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M14.3333 16.3333C15.0697 16.3333 15.6667 15.7364 15.6667 15C15.6667 14.2636 15.0697 13.6667 14.3333 13.6667C13.597 13.6667 13 14.2636 13 15C13 15.7364 13.597 16.3333 14.3333 16.3333Z"
                      stroke="#000000"
                      stroke-width="1.8"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M4.78002 4.99999H16.3334L15.2134 10.5933C15.1524 10.9003 14.9854 11.176 14.7417 11.3722C14.4979 11.5684 14.1929 11.6727 13.88 11.6667H6.83335C6.50781 11.6694 6.1925 11.553 5.94689 11.3393C5.70128 11.1256 5.54233 10.8295 5.50002 10.5067L4.48669 2.82666C4.44466 2.50615 4.28764 2.21182 4.04482 1.99844C3.80201 1.78505 3.48994 1.66715 3.16669 1.66666H1.66669"
                      stroke="#000000"
                      stroke-width="1.8"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <span>{count}</span>
                </Link>
              )
          }
          {
            isAuth ? (
              <Link to={`/clientprofile/${iduser}`} className="button button--auth">
                <p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12.1601 10.87C12.0601 10.86 11.9401 10.86 11.8301 10.87C9.45006 10.79 7.56006 8.84 7.56006 6.44C7.56006 3.99 9.54006 2 12.0001 2C14.4501 2 16.4401 3.99 16.4401 6.44C16.4301 8.84 14.5401 10.79 12.1601 10.87Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M7.16021 14.56C4.74021 16.18 4.74021 18.82 7.16021 20.43C9.91021 22.27 14.4202 22.27 17.1702 20.43C19.5902 18.81 19.5902 16.17 17.1702 14.56C14.4302 12.73 9.92021 12.73 7.16021 14.56Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg></p>
              </Link>
            ) : (

              <div  className="button button--auth" onClick={()=>setActive(!active)}>
                <p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12.1601 10.87C12.0601 10.86 11.9401 10.86 11.8301 10.87C9.45006 10.79 7.56006 8.84 7.56006 6.44C7.56006 3.99 9.54006 2 12.0001 2C14.4501 2 16.4401 3.99 16.4401 6.44C16.4301 8.84 14.5401 10.79 12.1601 10.87Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M7.16021 14.56C4.74021 16.18 4.74021 18.82 7.16021 20.43C9.91021 22.27 14.4202 22.27 17.1702 20.43C19.5902 18.81 19.5902 16.17 17.1702 14.56C14.4302 12.73 9.92021 12.73 7.16021 14.56Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                </p>
              </div>
              
            )
          }
          <ModalAdd active={active} setActive={setActive}/>
        </div>
      </div>
    </div>
  )
}

export default Header
